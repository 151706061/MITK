INCLUDE(CMake/PluginHelpers.cmake)

SET(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_CURRENT_SOURCE_DIR}/CMake/")

IF(USE_QT AND DESIRED_QT_VERSION EQUAL 4)
  SET(QT_MT_REQUIRED 1)
  SET(BUILD_QT_PLUGINS 1)
  FIND_PACKAGE(Qt)
  
  INCLUDE(${QT_USE_FILE})
ENDIF(USE_QT AND DESIRED_QT_VERSION EQUAL 4)

OPTION(BUILD_ALL_OPENCHERRY_PLUGINS "Build all plugins (overriding selection)")
MARK_AS_ADVANCED(BUILD_ALL_OPENCHERRY_PLUGINS)

OPTION(OPENCHERRY_STATIC "Build all plugins as static libraries" OFF)
MARK_AS_ADVANCED(OPENCHERRY_STATIC)

FIND_PACKAGE(Poco REQUIRED)

SET(OPENCHERRY_SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR})

# Clear the cache variables
SET(OPENCHERRY_PLUGIN_SOURCE_DIRS "" CACHE INTERNAL "List of base plugin source directories" FORCE)
SET(OPENCHERRY_PLUGIN_BINARY_DIRS "" CACHE INTERNAL "List of base plugin binary directories" FORCE)

COLLECT_PLUGINS(${CMAKE_CURRENT_BINARY_DIR} ON ${BUILD_ALL_OPENCHERRY_PLUGINS})

CONFIGURE_FILE(openCherryConfig.cmake.in ${CMAKE_CURRENT_BINARY_DIR}/openCherryConfig.cmake @ONLY)