PROJECT(@CUSTOM_PROJECT_NAME@)
CMAKE_MINIMUM_REQUIRED(VERSION 2.4)

IF(COMMAND CMAKE_POLICY)
  CMAKE_POLICY(SET CMP0003 OLD)
ENDIF(COMMAND CMAKE_POLICY)

SET(CMAKE_LIBRARY_OUTPUT_DIRECTORY "${PROJECT_BINARY_DIR}/bin" CACHE INTERNAL "Single output directory for building all libraries.")

SET(EXECUTABLE_OUTPUT_PATH "${PROJECT_BINARY_DIR}/bin" CACHE INTERNAL "Single output directory for building all executables.")

# This variable will contain a list of directories
# which contain your binary plug-ins
SET(@CUSTOM_PROJECT_NAME@_PLUGIN_BINARY_DIRS "" CACHE INTERNAL "@CUSTOM_PROJECT_NAME@ base plugin directories." FORCE)

@FIND_PACKAGE_QT4@
INCLUDE(${QT_USE_FILE})

SET(MITK_USE_OPENCHERRY 1)
FIND_PACKAGE(MITK REQUIRED)

ADD_SUBDIRECTORY(Bundles)

# Now build a custom executable to start the
# openCherry Workbench with our plug-ins
INCLUDE_DIRECTORIES(${OPENCHERRY_PLUGIN_SOURCE_DIRS})
LINK_DIRECTORIES("${org.opencherry.osgi_BIN_DIR}/bin")
ADD_EXECUTABLE(@CUSTOM_PROJECT_EXECUTABLE@ @CUSTOM_PROJECT_EXECUTABLE@.cpp)
TARGET_LINK_LIBRARIES(@CUSTOM_PROJECT_EXECUTABLE@ optimized org_opencherry_osgi debug org_opencherry_osgi${OPENCHERRY_DEBUG_POSTFIX})

# Configure the application's .ini file
SET(PLUGIN_CACHE_DIR "${EXECUTABLE_OUTPUT_PATH}/plugin_cache")
SET(PLUGIN_BINARY_DIRS "${CMAKE_LIBRARY_OUTPUT_DIRECTORY}/Bundles")
CONFIGURE_FILE("${CMAKE_CURRENT_SOURCE_DIR}/@CUSTOM_PROJECT_EXECUTABLE@.ini"
               "${EXECUTABLE_OUTPUT_PATH}/@CUSTOM_PROJECT_EXECUTABLE@.ini" @ONLY)
              

# If we are under Windows, create two batch files which correctly
# set up the environment for the application and for VS 2008
IF(WIN32)
  SET(APP_BUILD_TYPE debug)
  CONFIGURE_FILE(start@CUSTOM_PROJECT_EXECUTABLE@.bat.in
               ${EXECUTABLE_OUTPUT_PATH}/start@CUSTOM_PROJECT_EXECUTABLE@_${APP_BUILD_TYPE}.bat @ONLY)
  SET(APP_BUILD_TYPE release)
  CONFIGURE_FILE(start@CUSTOM_PROJECT_EXECUTABLE@.bat.in
               ${EXECUTABLE_OUTPUT_PATH}/start@CUSTOM_PROJECT_EXECUTABLE@_${APP_BUILD_TYPE}.bat @ONLY)
               
  # Configure VS batch file
  CONFIGURE_FILE("${CMAKE_CURRENT_SOURCE_DIR}/startVS2008.bat.in"
               "${PROJECT_BINARY_DIR}/startVS2008.bat" @ONLY)
ENDIF(WIN32)
