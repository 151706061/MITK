INCLUDE_DIRECTORIES()

FOREACH(dir  ${CORE_DIRECTORIES})
SET(MODULE_INCLUDE_DIRS ${MODULE_INCLUDE_DIRS} ${CMAKE_CURRENT_SOURCE_DIR}/${dir})
ENDFOREACH(dir in ${CORE_DIRECTORIES})
SET(MODULE_NAME mitkExt)
CONFIGURE_FILE(moduleIncludeConf.cmake.in ${MODULE_NAME}Config.cmake @ONLY)

SET(ALL_FILES_CPP "")
SET(ALL_FILES_H "")
SET(TOOL_CPPS "")
  
INCLUDE(files.cmake)

# modify list of tool filenames. For the classes inside these files, we'll create ITK factories
FOREACH(TOOL_FILE ${TOOL_FILES})
  STRING(REGEX REPLACE "(.*)Tool" "Interactions/\\1Tool" TOOL_FILE ${TOOL_FILE})
  SET(NEW_TOOL_FILES ${TOOL_FILE} ${NEW_TOOL_FILES})
ENDFOREACH(TOOL_FILE ${TOOL_FILES})
SET(TOOL_FILES ${NEW_TOOL_FILES})
INCLUDE_DIRECTORIES(${PROJECT_BINARY_DIR})

MITK_GENERATE_TOOLS_LIBRARY()
#SET(CPP_FILES ${TOOL_CPPS} ${CPP_FILES})

CONFIGURE_FILE(${PROJECT_SOURCE_DIR}/CMake/ToolExtensionITKFactory.cpp.in ${PROJECT_BINARY_DIR}/ToolExtensionITKFactory.cpp.in COPYONLY)
CONFIGURE_FILE(${PROJECT_SOURCE_DIR}/CMake/ToolExtensionITKFactoryLoader.cpp.in ${PROJECT_BINARY_DIR}/ToolExtensionITKFactoryLoader.cpp.in COPYONLY)
CONFIGURE_FILE(${PROJECT_SOURCE_DIR}/CMake/ToolGUIExtensionITKFactory.cpp.in ${PROJECT_BINARY_DIR}/ToolGUIExtensionITKFactory.cpp.in COPYONLY)

SET(ALL_FILES_CPP ${CPP_FILES} ${CPP_FILES_GENERATED})

ORGANIZE_SOURCES(${ALL_FILES_CPP} ${ALL_FILES_H})

FIND_PACKAGE(OpenGL)
IF(NOT OPENGL_FOUND)
  MESSAGE("GL is required for MITK rendering")
ENDIF(NOT OPENGL_FOUND )
INCLUDE_DIRECTORIES(${OPENGL_INCLUDE_DIR})
INCLUDE_DIRECTORIES(${IPSEGMENTATION_INCLUDE_DIR} ${ANN_INCLUDE_DIR})
IF(CMAKE_COMPILER_IS_GNUCC)
  OPTION(MITK_USE_GCC_VISIBILITY "Use gcc's -fvisibility option to hide exported symbols" OFF) 
  IF(MITK_USE_GCC_VISIBILITY)
    ADD_DEFINITIONS("-fvisibility=hidden")
  ENDIF(MITK_USE_GCC_VISIBILITY)
ENDIF(CMAKE_COMPILER_IS_GNUCC)

# we have to add .dox and .ui files here -- otherwise VisualStudio doesn't show these files in the solution
ADD_LIBRARY(mitkCoreExt SHARED ${ALL_FILES_CPP} ${ALL_FILES_H} ${CORRESPONDING_H_FILES} ${CORRESPONDING_TXX_FILES} ${GLOBBED_TXX_FILES} ${GLOBBED_DOX_FILES} ${GLOBBED_UI_FILES} ${TOOL_CPPS})

# install only if shared lib (for now)
INSTALL(TARGETS mitkCoreExt
   RUNTIME DESTINATION bin
   LIBRARY DESTINATION lib
   ARCHIVE DESTINATION lib/static
)
#TARGET_LINK_LIBRARIES(mitkCoreExt ${LIBRARIES_FOR_${KITNAME}_CORE}  ${IPFUNC_LIBRARY} ipSegmentation ann)
TARGET_LINK_LIBRARIES(mitkCoreExt mitkCore ${LIBRARIES_FOR_${KITNAME}_CORE}  ${IPFUNC_LIBRARY}ipSegmentation)
#TARGET_LINK_LIBRARIES(mitkCoreExt pic2vtk IIL4MITK ${OPENGL_LIBRARIES} )

IF(WIN32)
  OPTION(MITK_USE_TD_MOUSE "Enable support for 3D Connexion SpaceNavigator" OFF)
ENDIF(WIN32)
