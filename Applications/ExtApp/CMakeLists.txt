SET(MITK_USE_OPENCHERRY 1)
SET(MITK_USE_EXT 1)
FIND_PACKAGE(MITK)

INCLUDE_DIRECTORIES(${OPENCHERRY_PLUGIN_SOURCE_DIRS} ${Poco_INCLUDE_DIRS})
LINK_DIRECTORIES(${Poco_LIBRARY_DIRS})
  
ADD_EXECUTABLE(ExtApp ExtApp.cpp)

TARGET_LINK_LIBRARIES(ExtApp optimized org_opencherry_osgi debug org_opencherry_osgi${OPENCHERRY_DEBUG_POSTFIX})

SET(_plugin_deps ${OPENCHERRY_ENABLED_PLUGINS} ${MITK_CORE_ENABLED_PLUGINS} ${MITK_MODULES_ENABLED_PLUGINS})

IF(_plugin_deps)
  # Make sure all enabled plug-ins are up to date
  ADD_DEPENDENCIES(ExtApp ${_plugin_deps})
ENDIF()

SET(OPENCHERRY_PLUGIN_CACHE_DIR "${EXECUTABLE_OUTPUT_PATH}/plugin_cache")

CONFIGURE_FILE(ExtApp.ini
               ${EXECUTABLE_OUTPUT_PATH}/ExtApp.ini)

IF(WIN32)
  SET(EXTAPP_BUILD_TYPE debug)
  CONFIGURE_FILE(startExtApp.bat.in
               ${EXECUTABLE_OUTPUT_PATH}/startExtApp_${EXTAPP_BUILD_TYPE}.bat @ONLY)
  SET(EXTAPP_BUILD_TYPE release)
  CONFIGURE_FILE(startExtApp.bat.in
               ${EXECUTABLE_OUTPUT_PATH}/startExtApp_${EXTAPP_BUILD_TYPE}.bat @ONLY)
ENDIF(WIN32)
